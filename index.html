<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø¯Ù…Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ - Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; margin: 0; padding: 10px; }
        
        #loginScreen { position: fixed; inset: 0; background: #0f172a; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-box { background: #1e293b; padding: 30px; border-radius: 20px; text-align: center; border: 2px solid #6366f1; width: 85%; max-width: 350px; }
        #mainContent { display: none; }

        #adminAlert { display: none; background: #b91c1c; color: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ef4444; animation: flash 2s infinite; }
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .main-title { text-align: center; color: #818cf8; margin-bottom: 20px; }
        .section { background: #1e293b; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #334155; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 10px; }
        
        .card { background: #0f172a; padding: 10px; border-radius: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .bar-wrap { height: 60px; background: #334155; border-radius: 5px; overflow: hidden; margin: 5px 0; display: flex; align-items: flex-end; }
        .bar { width: 100%; transition: height 1s; }
        
        .bg-high { background: linear-gradient(to top, #16a34a, #4ade80); }
        .bg-mid { background: linear-gradient(to top, #ca8a04, #facc15); }
        .bg-low { background: linear-gradient(to top, #dc2626, #f87171); }

        textarea, input[type="text"], input[type="password"], select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; margin-bottom: 10px; outline: none; }
        .btn { background: #6366f1; color: white; padding: 12px; width: 100%; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        
        .chat-display { height: 180px; overflow-y: auto; background: #0f172a; padding: 10px; border-radius: 10px; margin-bottom: 10px; }
        .chat-msg { background: #1e293b; padding: 6px 10px; border-radius: 10px; margin-bottom: 6px; font-size: 13px; border-right: 3px solid #6366f1; }
        
        #prayerTimer { display: none; background: #312e81; padding: 15px; border-radius: 15px; border: 2px solid #818cf8; margin-top: 15px; text-align: center; }
        .counter { font-size: 45px; font-weight: bold; color: #fbbf24; margin: 5px 0; }
        .prayer-text-display { font-size: 18px; font-weight: bold; color: #fef3c7; min-height: 80px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px; text-align: center; }

        .switch-container { display: flex; justify-content: space-between; align-items: center; background: #334155; padding: 10px 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #ec4899; }
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #1e293b; transition: .4s; border-radius: 34px; border: 1px solid #475569; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ec4899; }
        input:checked + .slider:before { transform: translateX(22px); }
        .love-msg { background: rgba(236, 72, 153, 0.1); border-right: 4px solid #ec4899; padding: 10px; border-radius: 8px; font-size: 14px; color: #fbcfe8; margin-bottom:15px; }
        .mood-btn { font-size: 32px; cursor: pointer; transition: 0.2s; padding: 5px; }
    </style>
</head>
<body>

    <div id="loginScreen">
        <div class="login-box">
            <h3 style="margin:0 0 10px 0; color:#818cf8;">â€  Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† â€ </h3>
            <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn" onclick="checkAccess()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="mainContent">
        <div class="main-title">
            <h2 style="margin:0;">Ø®Ø¯Ù…Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</h2>
            <small>ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ ÙˆØ£Ø¨ÙˆØ³ÙŠÙÙŠÙ† ÙˆØ£Ø¨Ø³Ø®ÙŠØ±ÙˆÙ† Ø§Ù„Ù‚Ù„ÙŠÙ†ÙŠ</small>
        </div>

        <div id="adminAlert">
            <b style="display:block;">ğŸ“¢ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø®Ø¯Ø§Ù…:</b>
            <span id="alertText"></span>
        </div>

        <div class="section">
            <h3 style="margin-top:0; color: #fbbf24;">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù</h3>
            <div id="leaderboard" class="grid"></div>
        </div>

        <div class="section">
            <h3>ğŸ“ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</h3>
            <input type="text" id="userName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." oninput="localStorage.setItem('chat_user_name', this.value)">
        </div>

        <div id="chatSection" class="section" style="display:none; border-right: 5px solid #6366f1;">
            <h3>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</h3>
            <div id="chatBox" class="chat-display"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
                <button onclick="sendChat()" style="background:#6366f1; border:none; padding:0 15px; border-radius:10px; color:white;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>

        <div class="switch-container">
            <span style="font-weight: bold;">ğŸŒ± Ø±ÙƒÙ† Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©</span>
            <label class="switch">
                <input type="checkbox" onchange="document.getElementById('psyArea').style.display = this.checked ? 'block' : 'none'">
                <span class="slider"></span>
            </label>
        </div>

        <div id="psyArea" class="section" style="display: none; border: 2px solid #ec4899;">
            <div class="love-msg">Ù…Ø§ØªØ®ÙØ´ Ø§Ø­Ù†Ø§ Ø¬Ù†Ø¨Ùƒ ÙƒÙ„Ù†Ø§ Ø¨Ù†Ø­Ø¨Ùƒ ÙˆØ§Ù†Øª ØºØ§Ù„ÙŠ Ø¹Ù„Ù‰ Ù‚Ù„Ø¨ Ø§Ù„Ù…Ø³ÙŠØ­.. â¤ï¸</div>
            
            <p style="text-align:center; font-size:13px; margin:0 0 10px 0;">ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„Ø¢Ù†ØŸ</p>
            <div style="display:flex; justify-content:space-around; margin-bottom:15px;">
                <span class="mood-btn" onclick="sendMood('ğŸ˜Š')">ğŸ˜Š</span>
                <span class="mood-btn" onclick="sendMood('ğŸ˜Œ')">ğŸ˜Œ</span>
                <span class="mood-btn" onclick="sendMood('ğŸ˜Ÿ')">ğŸ˜Ÿ</span>
                <span class="mood-btn" onclick="sendMood('ğŸ˜¢')">ğŸ˜¢</span>
                <span class="mood-btn" onclick="sendMood('ğŸ˜«')">ğŸ˜«</span>
            </div>

            <select id="psyNeed">
                <option value="ÙØ¶ÙØ¶Ø© ğŸ—£ï¸">Ù…Ø¬Ø±Ø¯ ÙØ¶ÙØ¶Ø© ğŸ—£ï¸</option>
                <option value="ØµÙ„Ø§Ø© ğŸ™">ØµÙ„Ø§Ø© Ù…Ù† Ø£Ø¬Ù„ÙŠ ğŸ™</option>
                <option value="Ø¥Ù†Ù‚Ø§Ø° Ø³Ø±ÙŠØ¹ ğŸš¨">Ø¥Ù†Ù‚Ø§Ø° Ø³Ø±ÙŠØ¹ ğŸš¨</option>
                <option value="Ø¯Ø¹Ù… ğŸ¤">Ø¯Ø¹Ù… ÙˆØªÙˆØ¬ÙŠÙ‡ ğŸ¤</option>
            </select>

            <textarea id="psyMsg" placeholder="Ø§ÙƒØªØ¨ Ù…Ø§ Ø¨Ù‚Ù„Ø¨Ùƒ Ù‡Ù†Ø§..." style="height: 80px;"></textarea>
            <button class="btn" style="background:#ec4899; margin-bottom:15px;" onclick="sendPsyMsg()">Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø®ØµÙˆØµÙŠØ© ğŸ•Šï¸</button>

            <button class="btn" style="background:#fbbf24; color:#000;" onclick="startPrayerSession()">âœ¨ ÙŠÙ„Ø§ Ù†ØµÙ„Ùˆ Ø³ÙˆØ§ âœ¨</button>

            <div id="prayerTimer">
                <div class="prayer-text-display" id="activePrayer">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø©...</div>
                <div class="counter" id="count">0</div>
                <button class="btn" style="background:#818cf8; height: 80px; font-size:18px;" onclick="countPrayer()">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø¯ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ â”</button>
                <textarea id="thanksMsg" placeholder="Ø§Ù†Ø§ Ø¨Ø´ÙƒØ±Ùƒ Ù…Ù† ÙƒÙ„ Ù‚Ù„Ø¨ÙŠ Ø¹Ù„Ù‰..." style="height: 60px; margin-top:10px; font-size:13px;"></textarea>
                <button class="btn" style="background:#ef4444; margin-top:5px; padding:5px;" onclick="endPrayer()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø©</button>
            </div>
        </div>

        <div class="section">
            <h3>âœ‰ï¸ Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
            <textarea id="secretMsg" placeholder="Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ©..." style="height: 60px;"></textarea>
            <button class="btn" onclick="sendSecret()">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
        </div>
    </div>

<script>
    const config = { databaseURL: "https://church-a408e-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(config);
    const db = firebase.database();
    let pCount = 0;
    
    // Ø¬Ù…Ù„ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù€ 11 Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    const prayers = [
        "Ø¨Ø­Ø¨Ùƒ ÙŠØ§Ø±Ø¨ÙŠ ÙŠØ³ÙˆØ¹ ÙˆØ¹Ø§ÙˆØ² Ù‚Ù„Ø¨ÙŠ ÙŠØªÙ…Ù„Ø§ Ø¨Ø­Ø¨Ùƒ",
        "Ù‚Ù„Ø¨ÙŠ ÙŠØ§Ø±Ø¨ÙŠ ÙŠØ³ÙˆØ¹ Ø®Ù„ÙŠÙ‡ ÙƒÙ„Ù‡ Ù…Ù„ÙƒÙƒ",
        "Ø§Ø±Ø¬ÙˆÙƒ Ø§Ø³Ù†Ø¯ÙŠ ÙŠØ§Ø§Ù„Ù‡ÙŠ ÙÙŠ Ø¶Ø¹ÙÙŠ",
        "Ø§Ø´ÙƒØ±Ùƒ Ø§Ø´ÙƒØ±Ùƒ Ø¹Ù„ÙŠ Ù…Ø­Ø¨ØªÙƒ Ù„ÙŠ",
        "Ø§Ø¬Ø¹Ù„ ÙÙƒØ±ÙŠ Ù†Ù‚ÙŠ Ø²ÙŠ Ù…Ø§Ù†Øª Ø¹Ø§ÙˆØ²Ù‡ Ø·Ø§Ù‡Ø± Ù…Ù† ÙƒÙ„ Ø´Ø±",
        "Ø³Ø§Ù…Ø­Ù†ÙŠ Ø¹Ù„ÙŠ Ø¶Ø¹ÙÙŠ Ø§Ù†Ø§ Ø§Ø¨Ù†Ùƒ ÙˆØ§Ù†Øª Ø§Ø¨ÙˆÙŠØ§",
        "Ø§Ø±Ø³Ù… Ø·Ø±ÙŠÙ‚Ùƒ Ø§Ù…Ø§Ù…ÙŠ Ø§Ù…Ø´ÙŠ ÙÙŠÙ‡",
        "Ø®Ù„ÙŠÙ†ÙŠ Ø§Ø­Ø³ Ø¨Ø­Ø¶ÙˆØ±Ùƒ Ø¬ÙˆØ§ Ù‚Ù„Ø¨ÙŠ",
        "Ø§Ø´ÙƒØ±Ùƒ Ù„Ø§Ù†ÙŠ ØªØ³Ù…Ø¹Ù†ÙŠ Ø§Ù†Ø§ Ø§Ù„Ø®Ø§Ø·Ø¦",
        "Ø§Ù†Ø± Ø¹ÙŠÙ†ÙŠ ÙŠØ§Ø±Ø¨ÙŠ ÙŠØ³ÙˆØ¹ Ø§Ù„Ù…Ø³ÙŠØ­ Ù„ÙƒÙŠ Ø§Ø±Ø§Ùƒ",
        "Ø§ÙØªØ­ Ø°Ù‡Ù†ÙŠ Ø¹Ù„Ø´Ø§Ù† Ø§Ø­Ø¨ ÙˆØµØ§ÙŠØ§Ùƒ"
    ];

    function checkAccess() {
        if(document.getElementById('passInput').value === "jesus") {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            startApp();
        } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£!"); }
    }

    function startPrayerSession() {
        if(confirm("Ù…Ø³ØªØ¹Ø¯ ØªÙ‚Ø¶ÙŠ ÙˆÙ‚Øª Ù‡Ø§Ø¯ÙŠ Ù…Ø¹ Ø±Ø¨Ù†Ø§ØŸ")) {
            document.getElementById('prayerTimer').style.display = 'block';
            pCount = 0;
            updatePrayerDisplay();
        }
    }

    function countPrayer() {
        pCount++;
        updatePrayerDisplay();
        if(window.navigator.vibrate) window.navigator.vibrate(40);
    }

    function updatePrayerDisplay() {
        document.getElementById('count').innerText = pCount;
        const index = pCount % prayers.length;
        document.getElementById('activePrayer').innerText = prayers[index];
    }

    async function endPrayer() {
        const thanks = document.getElementById('thanksMsg').value;
        const name = document.getElementById('userName').value || "Ù…Ø®Ø¯ÙˆÙ…";
        if(pCount > 0) {
            await db.ref("psychology/prayers").push({ sender: name, repetition: pCount, thanks: thanks, time: new Date().toLocaleString('ar-EG') });
            alert("ØµÙ„Ø§Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©.. Ø±Ø¨Ù†Ø§ ÙŠÙØ±Ø­ Ù‚Ù„Ø¨Ùƒ!");
        }
        document.getElementById('prayerTimer').style.display = 'none';
        document.getElementById('thanksMsg').value = "";
    }

    function startApp() {
        if(localStorage.getItem('chat_user_name')) document.getElementById('userName').value = localStorage.getItem('chat_user_name');
        db.ref("admin_announcement").on("value", snap => {
            const text = snap.val();
            document.getElementById('adminAlert').style.display = (text && text.trim() !== "") ? 'block' : 'none';
            document.getElementById('alertText').innerText = text;
        });
        db.ref("points_data").on("value", snap => {
            const list = document.getElementById('leaderboard'); list.innerHTML = "";
            const data = snap.val(); if(!data) return;
            Object.values(data).sort((a,b) => b.score - a.score).forEach(p => {
                let colorClass = p.score >= 70 ? 'bg-high' : (p.score >= 40 ? 'bg-mid' : 'bg-low');
                list.innerHTML += `<div class="card"><div class="bar-wrap"><div class="bar ${colorClass}" style="height:${Math.min(p.score, 100)}%"></div></div><div style="font-weight:bold; color:#fbbf24;">${p.score}</div><div style="font-size:11px;">${p.name}</div></div>`;
            });
        });
        db.ref("settings/chatEnabled").on("value", snap => { document.getElementById('chatSection').style.display = snap.val() !== false ? "block" : "none"; });
        db.ref("chat").limitToLast(15).on("value", snap => {
            const box = document.getElementById('chatBox'); box.innerHTML = "";
            snap.forEach(c => { box.innerHTML += `<div class="chat-msg"><b>${c.val().sender}:</b> ${c.val().text}</div>`; });
            box.scrollTop = box.scrollHeight;
        });
    }

    function sendMood(mood) {
        const name = document.getElementById('userName').value || "Ù…Ø®Ø¯ÙˆÙ…";
        db.ref("psychology/moods").push({name, mood, time: new Date().toLocaleTimeString('ar-EG')});
        alert("Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙ†Ø§ Ø´Ø¹ÙˆØ±Ùƒ ğŸ˜Š");
    }

    function sendChat() {
        const inp = document.getElementById('chatInput'); const name = document.getElementById('userName').value || "Ù…Ø®Ø¯ÙˆÙ…";
        if(inp.value.trim()) { db.ref("chat").push({sender: name, text: inp.value}); inp.value = ""; }
    }
    async function sendPsyMsg() {
        const txt = document.getElementById('psyMsg').value.trim();
        const need = document.getElementById('psyNeed').value;
        const name = document.getElementById('userName').value || "Ù…Ø®Ø¯ÙˆÙ…";
        if(!txt) return;
        await db.ref("psychology/confessions").push({ sender: name, need: need, text: txt, time: new Date().toLocaleString('ar-EG') });
        alert("ÙˆØµÙ„Øª Ø±Ø³Ø§Ù„ØªÙƒ.. Ø±Ø¨Ù†Ø§ ÙŠØ±ÙŠØ­ Ù‚Ù„Ø¨Ùƒ âœ¨"); document.getElementById('psyMsg').value = "";
    }
    async function sendSecret() {
        const txt = document.getElementById('secretMsg').value.trim(); const name = document.getElementById('userName').value || "Ù…Ø¬Ù‡ÙˆÙ„";
        if(txt) { await db.ref("messages").push({sender: name, text: txt, time: new Date().toLocaleString('ar-EG')}); alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!"); document.getElementById('secretMsg').value = ""; }
    }
</script>
</body>
</html>
